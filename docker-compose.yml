services:
  acexy:
    container_name: acexy
    image: ghcr.io/krinkuto11/acexy-orchestrator:dev
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      ACEXY_ADDR: ":8080"            # Listen on port 8080
      ACEXY_SCHEME: "http"           # Use HTTP
      ACEXY_HOST: "acestream"        # Host is "acestream" or the name of the AceStream service
      ACEXY_PORT: "6878"             # Port is 6878
      ACEXY_TIMEOUT: "60s"           # Stream timeout when in M3U8 mode
      ACEXY_M3U8: "false"            # Disable M3U8 mode
      ACEXY_EMPTY_TIMEOUT: "60s"     # Timeout to close the connection if no data is received
      ACEXY_BUFFER: "4MB"            # Buffer size is 4MB
      ACEXY_NO_RESPONSE_TIMEOUT: "10s"  # Timeout to close the connection if no response is received
      # Orchestrator integration (optional)
      ACEXY_ORCH_URL: "http://orchestrator:8000"           # Base URL for orchestrator API (leave empty to disable orchestrator integration)
      ACEXY_ORCH_APIKEY: "contrase√±a"        # API key for orchestrator authentication (optional)
      # ACEXY_CONTAINER_ID: ""       # Container ID for orchestrator identification (auto-detected if empty)
      ACEXY_STREAM_GRACE_PERIOD: "5s"
      TZ: Europe/Madrid
      ACEXY_MAX_STREAMS_PER_ENGINE: 2
    networks:
      - aceserver
    depends_on:
      - orchestrator

  orchestrator:
    privileged: true
    container_name: orchestrator
    image: ghcr.io/krinkuto11/acestream-orchestrator:latest
    env_file: .env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "8000:8000"
    restart: on-failure
    networks:
      - aceserver

volumes:
  orchestrator-db:
